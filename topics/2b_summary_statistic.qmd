---
title: "Distributions and Summaries"
---

> Topic for 1/7.

Data science questions often involve many units, each of whom may have a unique value of the outcome variable. How do we summarize all of these outcome values? This page focuses on two approaches: visualizing the distribution and producing one or more summary statistics.

As an example, below we study household income (an outcome) which is defined for each household (a unit of analysis) among all U.S. households in 2022 (a target population).

## Visualizing the distribution

Not all households have the same income: there is a **distribution** of incomes across households. One way to study a distribution is by visualizing it with a histogram.

To produce this graph, we first downloaded survey data on [annual household income](https://cps.ipums.org/cps-action/variables/hhincome#description_section) from the 2022 [Current Population Survey](https://cps.ipums.org/cps/index.shtml). The histogram categorizes households into discrete income groups that are each \$25,000 wide. The height of each bar corresponds to the number of households falling in that income group. We can see that the most common household income values are below \$100,000, but a small number of households have very high incomes that create a long upper tail at the right.

```{r, echo = F, comment = F, message = F, warning = F, fig.width = 6, fig.height = 2}
library(tidyverse)
library(scales)
library(haven)

# 1. LOAD DATA

# Load microdata from the Current Population Survey
# https://cps.ipums.org/
micro <- read_dta("../data_raw/cps_00062.dta") |>
  filter(year == 2022)

prepared <- micro |>
  # Remove missing household incomes
  filter(hhincome != 99999999) |>
  mutate(hhincome = case_when(hhincome < 0 ~ 0,
                              T ~ hhincome)) |>
  # Restrict to one row per household
  # instead of one row per person
  group_by(year, serial) %>%
  filter(1:n() == 1) |>
  ungroup()

# Big visualization of U.S. household income distribution

p <- prepared |>
  filter(hhincome < 500e3) |>
  ggplot(aes(x = hhincome, weight = asecwth)) +
  geom_histogram(binwidth = 25e3, alpha = .4) +
  scale_x_continuous(labels = scales::label_dollar(),
                     name = "Household Income") +
  scale_y_continuous(breaks = NULL,
                     name = "Density") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 30, hjust = 1),
        panel.grid.minor = element_blank()) +
  theme_bw()
p
#ggsave(filename = "../slides/lec1/us2022_hh_dist_big.pdf",
#       height = 3, width = 4.5)
```

The simulated dataset [`incomeSimulated.csv`](../data/incomeSimulated.csv) available on the course website will enable you to produce a similar graph.

```{r, echo = F, warning = F, message = F}
# Produce simulated version
p0 <- prepared |>
  summarize(estimate = weighted.mean(hhincome < 5e3, w = asecwth)) |>
  pull(estimate)

meanlog <- prepared |>
  filter(hhincome >= 5e3) |>
  summarize(estimate = weighted.mean(log(hhincome), w = asecwth)) |>
  pull(estimate)

sdlog <- prepared |>
  filter(hhincome >= 5e3) |>
  summarize(estimate = sqrt(weighted.mean((log(hhincome) - meanlog) ^ 2, w = asecwth))) |>
  pull(estimate)

incomeSimulated <- tibble(id = 1:1000) |>
  mutate(
    is0 = rbinom(n(), 1, p0),
    hhincome = case_when(
      is0 == 1 ~ 0,
      is0 == 0 ~ exp(rnorm(n(), meanlog, sdlog))
    ),
    hhincome = case_when(
      hhincome <= 500e3 ~ hhincome,
      hhincome > 500e3 ~ 500e3
    )
  ) |>
  select(-is0) |>
  write_csv("../data/incomeSimulated.csv")
```

The code below will produce a basic version of this graph. First, you will need to prepare your environment by loading packages.

```{r, eval = F}
library(tidyverse) # for manipulating data
library(scales)    # for labeling graphs easily
```

Then, you can load the data from the course website.

```{r, eval = F}
incomeSimulated <- read_csv("https://soc114.github.io/data/incomeSimulated.csv")
```

The code below produces the graph.

```{r}
incomeSimulated |>
  ggplot(mapping = aes(x = hhincome)) +
  geom_histogram(binwidth = 25e3) +
  scale_x_continuous(
    name = "Household Income",
    labels = label_currency()
  )
```

This code starts with the dataset `incomeSimulated` and uses the pipe operator `|>` to pass the dataset into the plot. The `ggplot()` line creates the plot. The `mapping` argument defines the aethetics (`aes`) of the plot, with the `hhincome` variable being assigned to the `x`-axis. The `geom_histogram` line produces the plot. The `scale_x_continuous()` lines are an optional part to improve readability of the x-axis.

## The summary statistic

We often want to take a distribution and convert it to a **summary statistic**: a one-number parameter that summarizes a fact about the distribution. A summary statistic collapses the entire distribution down to a single number.

One summary statistic is the median: the value at which 50\% of households have higher incomes and 50\% of households have lower incomes.

```{r, echo = F, comment = F, message = F, warning = F, fig.width = 6, fig.height = 2}
summaries <- prepared |>
  summarize(median = Hmisc::wtd.quantile(hhincome, weights = asecwth,
                                       probs = .5),
            q10 = Hmisc::wtd.quantile(hhincome, weights = asecwth,
                                    probs = .1),
            q90 = Hmisc::wtd.quantile(hhincome, weights = asecwth,
                                    probs = .9),
            over_top = weighted.mean(hhincome > 500e3,
                                    w = asecwth),
            .groups = "drop")

p +
  geom_vline(xintercept = summaries$median,
             color = "blue", size = 2) +
  annotate(geom = "text", color = "blue", size = 4,
           x = 300e3, y = 2e7,
           label = paste("Median =",scales::dollar(summaries$median)),
           fontface = "bold")
#ggsave("../slides/lec1/us2022_hh_dist_median.pdf",
#       height = 3, width = 4.5)
```

You can produce the median using the simulated data [`incomeSimulated.csv`](../data/incomeSimulated.csv) with the code below.

```{r}
incomeSimulated |>
  summarize(estimated_median = median(hhincome))
```

This code starts with the `incomeSimulated` data and uses the pipe operator `|>` to pass the data to the `summarize()` function. The summarize function creates a new variable `estimated_median` which contains the median value of `hhincome`, calculated by applying the `median()` function to this variable. The `median()` function takes a vector of values and returns a single summary. The `summarize()` function converts our data that had `r nrow(incomeSimulated)` rows into a new format that has only 1 row containing the summary statistic.

One can also produce several summary statistics. The median is a useful measure of central tendency: it gives a sense of the income value in the middle of the distribution. But it may not give us a good sense of inequality, which requires some sense of the spread of the distribution. One may therefore want other summary statistics, such as the 90th and 10th percentiles. The 90th percentile is the household income value such that 90\% of households have lower incomes. The 10th percentile is the value such that 10\% of households have lower incomes.

```{r, echo = F, comment = F, message = F, warning = F, fig.width = 6, fig.height = 2}
p +
  geom_vline(xintercept = summaries$q90,
             color = "blue", size = 2) +
  geom_vline(xintercept = summaries$q10,
             color = "seagreen4", size = 2) +
  annotate(geom = "text", color = "blue", size = 4,
           x = 375e3, y = 2e7,
           label = paste0("90th percentile (",scales::dollar(summaries$q90),")"),
           fontface = "bold") +
  annotate(geom = "text", color = "black", size = 4,
           x = 375e3, y = 1.5e7,
           label = paste0("gets ",
                          round(summaries$q90 / summaries$q10),
                          "x as much as the")) +
  annotate(geom = "text", color = "seagreen4", size = 4,
           x = 375e3, y = 1e7,
           label = paste0("10th percentile (",scales::dollar(summaries$q10),")"),
           fontface = "bold")
#ggsave("../slides/lec1/us2022_hh_dist_9010.pdf",
#       height = 3, width = 4.5)
```

Below, we produce these summaries in the simulated data. Note that the `summarize()` function can produce several new variables containing several estimated summary statistics. Here we use the `quantile` function to produce the percentile estimates.

```{r}
incomeSimulated |>
  summarize(
    estimated_median = median(x = hhincome),
    estimated_10th_percentile = quantile(x = hhincome, probs = .1),
    estimated_90th_percentile = quantile(x = hhincome, probs = .9)
  )
```

<!-- One can combine summary statistics. The 90/10 income ratio ($\frac{\text{90th percentile}}{\text{10th percentile}}$) is one measure of inequality: how many dollars does a household at the 90th percentile get for every dollar that goes to a household at the 10th percentile? We might say that inequality is high to the degree that the 90/10 income ratio is large. -->

## How to choose a summary statistic?

The choice of summary statistic involves a subjective (non-empirical) choice about what aspect of the distribution is important to report. If you are normatively concerned with the growth of high incomes, you might want to summarize the 90th or even 99th percentile of the distribution. If you are concerned with the typical household, you might want to summarize by the median. If you are interested in patterns of inequality among low earners, you might summarize with the 10th percentile.
