{
  "hash": "b860b9a753e55b48cb1fa002ba08d11c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Why model?\"\nauthor: UCLA SOCIOL 114 \\break Winter 2025 \\break \\href{https://soc114.github.io/}{\\textcolor{blue}{soc114.github.io}}\ndate: 11 Feb 2025\nformat: beamer\nurlcolor: blue\ndate-format: DD MMM YYYY\nheader-includes:\n  \\usecolortheme{dove}\n  \\usepackage{tikz}\n  \\usetikzlibrary{arrows,shapes.arrows,positioning,shapes,patterns,calc}\n---\n\n\n\n\n\n\n\n\n\n\n\n\n## Arc of the course\n\nWe began by asking causal questions\n\n- Defining counterfactuals\n\nThen we discussed causal assumptions\n\n- Exchangeability and experiments\n- Consistency and positivity\n- Directed Acyclic Graphs\n\n. . .\n\n\\begin{center}\n\\Large\n5 weeks\n\\end{center}\n\n. . .\n\n\\begin{center}\n\\Large\n0 statistical models\n\\end{center}\n\n## Learning goals for today\n\nAt the end of class, you will be able to\n\n- explain the curse of dimensionality\n- recognize the possible futility of nonparametric estimation\n\n## Motivating a research question^[[Mare 1991](https://doi.org/10.2307/2095670), [Schwartz 2013](https://doi.org/10.1146/annurev-soc-071312-145544)]\n\nIncome inequality across households depends on\n\n1. inequality across individuals\n2. how individuals pool into households\n\nA college degree affects (1) and (2)\n\n\n## Research question\n\nTo what degree does finishing college increase the probability of having a spouse who finished college?\n\n. . .\n\n**Data.** [National Longitudinal Survey of Youth 1997](https://www.bls.gov/nls/nlsy97.htm)\n\n- Probability sample of U.S. non-institutional civilian youth age 12--16 on Dec 31 1996\n- Surveyed annually 1997--2011, then biennially\n- $n$ = 8,984\n\n## Data access\n\nTo access these data, first\n\n* set your working directory where you will be working\n* download two supporting files from us\n     1. [`nlsy97.NLSY97`](https://drive.google.com/file/d/1YcyaC1R5u9_d0-AX4ivqDiU0bRnEsAsJ/view?usp=sharing) is a tagset file containing the variable names\n     2. [`prepare_nlsy97.R`](https://drive.google.com/file/d/1fUdlhEsGGC0shREvu4znPPmJjtNi--Ko/view?usp=sharing) is an R script to prepare the data\n\n## Data access\n\nNow go to the data distributor\n\n1. [Register](https://nlsinfo.org/investigator/pages/register) with the survey\n2. [Log in](https://nlsinfo.org/investigator/pages/login) to the NLS Investigator\n3. Choose the NLSY97 study\n4. Upload the tagset [`nlsy97.NLSY97`](https://drive.google.com/file/d/1YcyaC1R5u9_d0-AX4ivqDiU0bRnEsAsJ/view?usp=sharing) that you downloaded from us\n5. In the Investigator, download the data. Type to change the file name from `default` to `nlsy97`\n6. Unzip the file. Drag `nlsy97.dat` into the folder you will work in\n7. In your R console, run the line of code below\n     * this will take about 30 seconds to run\n     * you will need these R packages: `tidyverse` and `Amelia`\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource(\"prepare_nlsy97.R\")\n```\n:::\n\n\n\n\n\nIn the future, you can now load the data with \n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd <- readRDS(\"d.RDS\")\n```\n:::\n\n\n\n\n\n\n\n## [Register](https://nlsinfo.org/investigator/pages/register) with the survey\n\n![](figures/nlsy97_register.png)\n\n## Choose the NLSY97 study\n\n![](figures/nlsy97_choose.png)\n\n## Upload [our tagset]()\n\n![](figures/nlsy97_upload1.png)\n![](figures/nlsy97_upload2.png)\n\n## Download the data\n\n![](figures/nlsy97_download.png)\n\n## Run our code\n\nThis code prepares the data file (one time, takes about 30 seconds)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource(\"prepare_NLSY97.R\")\n```\n:::\n\n\n\n\n\n\nThis code loads the prepared data (after the above, very fast)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd <- readRDS(\"d.RDS\")\n```\n:::\n\n\n\n\n\n\n## Research question\n\nTo what degree does finishing college increase the probability of having a spouse who finished college?\n\n. . .\n\n- Treatment $A$: Finished BA by age 25\n- Outcome $Y$: Spouse or partner at age 30--40 holds a BA\n     * 0 if no spouse or partner, or partner with no BA\n     * 1 if spouse or partner holds a BA\n\n. . .\n\n\\begin{center}\n\\begin{tikzpicture}[x = 1in, y = .7in]\n\\node (a) at (0,0) {$A$};\n\\node (y) at (1,0) {$Y$};\n\\node (l) at (-1,0) {$L$};\n\\draw[->, thick] (l) -- (a);\n\\draw[->, thick] (a) -- (y);\n\\draw[->, thick] (l) to[bend left] (y);\n\\node[anchor = north, align = center, font = \\footnotesize] at (a.south) {College\\\\Degree\\\\by Age 25};\n\\node[anchor = north, align = center, font = \\footnotesize] at (y.south) {Spouse\\\\at Age 35\\\\Has Degree};\n\\node[anchor = north, align = center, font = \\footnotesize] at (l.south) {Sex};\n\\end{tikzpicture}\n\\end{center}\n\n. . .\n\nAdjustment procedure\n\n1) Estimate within subgroups defined by \\{sex\\}\n2) Aggregate over the subgroups\n\n## Data\n\n\\footnotesize\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd %>%\n  select(sex, a, y) %>%\n  print(n = 8)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 7,771 × 3\n  sex    a          y    \n  <chr>  <chr>      <lgl>\n1 Female college    FALSE\n2 Male   no_college FALSE\n3 Female no_college FALSE\n4 Male   no_college TRUE \n5 Female no_college FALSE\n6 Male   no_college FALSE\n7 Female college    FALSE\n8 Male   college    TRUE \n# ℹ 7,763 more rows\n```\n\n\n:::\n:::\n\n\n\n\n\n\n## 1) Estimate in subgroups\n\n\\footnotesize\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nybar_in_subgroups <- d %>%\n  # Group by confounders and treatment\n  group_by(sex, a) %>%\n  # Summarize mean outcomes and nber of cases\n  summarize(ybar = mean(y),\n            n = n(),\n            .groups = \"drop\") %>%\n  print()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 4\n  sex    a           ybar     n\n  <chr>  <chr>      <dbl> <int>\n1 Female college    0.467   896\n2 Female no_college 0.102  2953\n3 Male   college    0.614   637\n4 Male   no_college 0.174  3285\n```\n\n\n:::\n:::\n\n\n\n\n\n\n## 1) Estimate in subgroups\n\n\\footnotesize\n\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 4\n  sex    a           ybar     n\n  <chr>  <chr>      <dbl> <int>\n1 Female college    0.467   896\n2 Female no_college 0.102  2953\n3 Male   college    0.614   637\n4 Male   no_college 0.174  3285\n```\n\n\n:::\n:::\n\n\n\n\n\n\n. . .\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npivoted <- ybar_in_subgroups %>%\n  pivot_wider(names_from = a,\n              values_from = c(\"ybar\",\"n\")) %>%\n  print()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 5\n  sex    ybar_college ybar_no_college n_college n_no_college\n  <chr>         <dbl>           <dbl>     <int>        <int>\n1 Female        0.467           0.102       896         2953\n2 Male          0.614           0.174       637         3285\n```\n\n\n:::\n:::\n\n\n\n\n\n\n## 1) Estimate in subgroups\n\n\\footnotesize\n\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 5\n  sex    ybar_college ybar_no_college n_college n_no_college\n  <chr>         <dbl>           <dbl>     <int>        <int>\n1 Female        0.467           0.102       896         2953\n2 Male          0.614           0.174       637         3285\n```\n\n\n:::\n:::\n\n\n\n\n\n\n. . .\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncate <- pivoted %>%\n  mutate(conditional_effect = ybar_college - ybar_no_college,\n         n_in_stratum = n_college + n_no_college) %>%\n  select(sex, conditional_effect, n_in_stratum) %>%\n  print()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 3\n  sex    conditional_effect n_in_stratum\n  <chr>               <dbl>        <int>\n1 Female              0.365         3849\n2 Male                0.440         3922\n```\n\n\n:::\n:::\n\n\n\n\n\n\n## 2) Aggregate over subgroups\n\n\\footnotesize\n\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 3\n  sex    conditional_effect n_in_stratum\n  <chr>               <dbl>        <int>\n1 Female              0.365         3849\n2 Male                0.440         3922\n```\n\n\n:::\n:::\n\n\n\n\n\n\n. . .\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncate %>%\n  summarize(population_average_effect = weighted.mean(\n    conditional_effect,\n    w = n_in_stratum\n  ))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 1\n  population_average_effect\n                      <dbl>\n1                     0.403\n```\n\n\n:::\n:::\n\n\n\n\n\n\n## Recap: Intuition\n\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](lec11_whymodel_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n## Recap: In code\n\n\\footnotesize\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd %>%\n  # Group by confounders and treatment\n  group_by(sex, a) %>%\n  # Estimate within subgroups\n  summarize(ybar = mean(y),\n            n = n(),\n            .groups = \"drop\") %>%\n  pivot_wider(names_from = a,\n              values_from = c(\"ybar\",\"n\")) %>%\n  mutate(conditional_effect = ybar_college - ybar_no_college,\n         n_in_stratum = n_college + n_no_college) %>%\n  # Aggregate over subgroups\n  summarize(population_average_effect = weighted.mean(\n    conditional_effect,\n    w = n_in_stratum\n  ))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 1\n  population_average_effect\n                      <dbl>\n1                     0.403\n```\n\n\n:::\n:::\n\n\n\n\n\n\n## Adjust for sex and race\n\n\\begin{center}\n\\begin{tikzpicture}[x = 1in, y = .4in]\n\\node (a) at (0,0) {$A$};\n\\node (y) at (1,0) {$Y$};\n\\node (l1) at (-1,1) {$L_1$};\n\\node (l2) at (-1,0) {$L_2$};\n\\draw[->, thick] (l1) -- (a);\n\\draw[->, thick] (l2) -- (a);\n\\draw[->, thick] (a) -- (y);\n\\draw[->, thick] (l1) to[bend left] (y);\n\\draw[->, thick] (l2) to[bend left] (y);\n\\node[anchor = north, align = center, font = \\footnotesize] at (a.south) {College\\\\Degree\\\\by Age 25};\n\\node[anchor = north, align = center, font = \\footnotesize] at (y.south) {Spouse\\\\at Age 35\\\\Has Degree};\n\\node[anchor = east, align = center, font = \\footnotesize] at (l1.west) {Sex};\n\\node[anchor = east, align = center, font = \\footnotesize] at (l2.west) {Race};\n\\end{tikzpicture}\n\\end{center}\n\n. . .\n\n1) Estimate effects within subgroups defined by \\{sex, race\\}\n2) Aggregate over subgroups\n\n## Adjust for sex and race\n\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](lec11_whymodel_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n## Adjust for sex and race\n\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](lec11_whymodel_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n## Adjust for sex, race, mom education\n\n\\begin{center}\n\\begin{tikzpicture}[x = 1in, y = .4in]\n\\node (a) at (0,0) {$A$};\n\\node (y) at (1,0) {$Y$};\n\\node (l1) at (-1,1) {$L_1$};\n\\node (l2) at (-1,.5) {$L_2$};\n\\node (l3) at (-1,0) {$L_3$};\n\\draw[->, thick] (l1) -- (a);\n\\draw[->, thick] (l2) -- (a);\n\\draw[->, thick] (l3) -- (a);\n\\draw[->, thick] (a) -- (y);\n\\draw[->, thick] (l1) to[bend left] (y);\n\\draw[->, thick] (l2) to[bend left] (y);\n\\draw[->, thick] (l3) to[bend left] (y);\n\\node[anchor = north, align = center, font = \\footnotesize] at (a.south) {College\\\\Degree\\\\by Age 25};\n\\node[anchor = north, align = center, font = \\footnotesize] at (y.south) {Spouse\\\\at Age 35\\\\Has Degree};\n\\node[anchor = east, align = center, font = \\footnotesize] at (l1.west) {Sex};\n\\node[anchor = east, align = center, font = \\footnotesize] at (l2.west) {Race};\n\\node[anchor = east, align = center, font = \\footnotesize] at (l3.west) {Mom Education};\n\\end{tikzpicture}\n\\end{center}\n\n1) Estimate effects within subgroups defined by \\{race,sex, mom education\\}\n2) Aggregate over subgroups\n\n## Adjust for sex, race, mom education\n\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](lec11_whymodel_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n## Adjust for sex, race, mom education\n\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](lec11_whymodel_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n## Adjust for sex, race, mom education, dad education\n\n\\begin{center}\n\\begin{tikzpicture}[x = 1in, y = .4in]\n\\node (a) at (0,0) {$A$};\n\\node (y) at (1,0) {$Y$};\n\\node (l1) at (-1,1) {$L_1$};\n\\node (l2) at (-1,.66) {$L_2$};\n\\node (l3) at (-1,.33) {$L_3$};\n\\node (l4) at (-1,0) {$L_4$};\n\\draw[->, thick] (l1) -- (a);\n\\draw[->, thick] (l2) -- (a);\n\\draw[->, thick] (l3) -- (a);\n\\draw[->, thick] (l4) -- (a);\n\\draw[->, thick] (a) -- (y);\n\\draw[->, thick] (l1) to[bend left] (y);\n\\draw[->, thick] (l2) to[bend left] (y);\n\\draw[->, thick] (l3) to[bend left] (y);\n\\draw[->, thick] (l4) to[bend left] (y);\n\\node[anchor = north, align = center, font = \\footnotesize] at (a.south) {College\\\\Degree\\\\by Age 25};\n\\node[anchor = north, align = center, font = \\footnotesize] at (y.south) {Spouse\\\\at Age 35\\\\Has Degree};\n\\node[anchor = east, align = center, font = \\footnotesize] at (l1.west) {Sex};\n\\node[anchor = east, align = center, font = \\footnotesize] at (l2.west) {Race};\n\\node[anchor = east, align = center, font = \\footnotesize] at (l3.west) {Mom Education};\n\\node[anchor = east, align = center, font = \\footnotesize] at (l4.west) {Dad Education};\n\\end{tikzpicture}\n\\end{center}\n\n1) Estimate effects within subgroups defined by \\{race,sex, mom education, dad education\\}\n2) Aggregate over subgroups\n\n## Adjust for sex, race, mom education, dad education\n\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](lec11_whymodel_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n## Adjust for sex, race, mom education, dad education\n\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](lec11_whymodel_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n## Curse of dimensionality: Unpopulated cells\n\n\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n\n\n\\scriptsize\n\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 147 × 6\n   sex    race    mom_educ    dad_educ     n_college n_no_college\n   <chr>  <chr>   <fct>       <fct>            <int>        <int>\n 1 Female H       No mom      No dad              NA           32\n 2 Female H       No mom      < HS                NA            6\n 3 Female H       No mom      High school         NA            5\n 4 Female H       No mom      Some college        NA           13\n 5 Female H       < HS        College             NA            1\n 6 Female H       High school < HS                NA           34\n 7 Female Non-H B No mom      < HS                NA            2\n 8 Female Non-H B No mom      High school         NA           12\n 9 Female Non-H B No mom      College             NA            4\n10 Female Non-H B < HS        High school         NA           24\n# ℹ 137 more rows\n```\n\n\n:::\n:::\n\n\n\n\n\n\n## Curse of dimensionality\n\n\\centering\n\\begin{tikzpicture}[x = 1in, y = .4in]\n\\node (a) at (0,0) {$A$};\n\\node (y) at (1,0) {$Y$};\n\\node (l1) at (-1,1) {$L_1$};\n\\node (l2) at (-1,.66) {$L_2$};\n\\node (l3) at (-1,.33) {$L_3$};\n\\node (l4) at (-1,0) {$L_4$};\n\\draw[->, thick] (l1) -- (a);\n\\draw[->, thick] (l2) -- (a);\n\\draw[->, thick] (l3) -- (a);\n\\draw[->, thick] (l4) -- (a);\n\\draw[->, thick] (a) -- (y);\n\\draw[->, thick] (l1) to[bend left] (y);\n\\draw[->, thick] (l2) to[bend left] (y);\n\\draw[->, thick] (l3) to[bend left] (y);\n\\draw[->, thick] (l4) to[bend left] (y);\n\\node[anchor = north, align = center, font = \\footnotesize] at (a.south) {College\\\\Degree\\\\by Age 25};\n\\node[anchor = north, align = center, font = \\footnotesize] at (y.south) {Spouse\\\\at Age 35\\\\Has Degree};\n\\node[anchor = east, align = center, font = \\footnotesize] at (l1.west) {Sex};\n\\node[anchor = east, align = center, font = \\footnotesize] at (l2.west) {Race};\n\\node[anchor = east, align = center, font = \\footnotesize] at (l3.west) {Mom Education};\n\\node[anchor = east, align = center, font = \\footnotesize] at (l4.west) {Dad Education};\n\\end{tikzpicture}\n\n\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n\n\n\\huge\n**4.2%** of the sample \n\n\\normalsize\nis in a subgroup with either 0 treated or 0 untreated units\n\n## Curse of dimensionality\n\n\\centering\n\n\\begin{tikzpicture}[x = 1in, y = .4in]\n\\node (a) at (0,0) {$A$};\n\\node (y) at (1,0) {$Y$};\n\\node (l1) at (-1,2) {$L_1$};\n\\node (l2) at (-1,1.66) {$L_2$};\n\\node (l3) at (-1,1.33) {$L_3$};\n\\node (l4) at (-1,1) {$L_4$};\n\\node (l5) at (-1,.66) {$L_5$};\n\\node (l6) at (-1,.33) {$L_6$};\n\\node (l7) at (-1,0) {$L_7$};\n\\draw[->, thick] (l1) -- (a);\n\\draw[->, thick] (l2) -- (a);\n\\draw[->, thick] (l3) -- (a);\n\\draw[->, thick] (l4) -- (a);\n\\draw[->, thick] (l5) -- (a);\n\\draw[->, thick] (l6) -- (a);\n\\draw[->, thick] (l7) -- (a);\n\\draw[->, thick] (a) -- (y);\n\\draw[->, thick] (l1) to[bend left] (y);\n\\draw[->, thick] (l2) to[bend left] (y);\n\\draw[->, thick] (l3) to[bend left] (y);\n\\draw[->, thick] (l4) to[bend left] (y);\n\\draw[->, thick] (l5) to[bend left] (y);\n\\draw[->, thick] (l6) to[bend left] (y);\n\\draw[->, thick] (l7) to[bend left] (y);\n\\node[anchor = north, align = center, font = \\footnotesize] at (a.south) {College\\\\Degree\\\\by Age 25};\n\\node[anchor = north, align = center, font = \\footnotesize] at (y.south) {Spouse\\\\at Age 35\\\\Has Degree};\n\\node[anchor = east, align = center, font = \\footnotesize] at (l1.west) {Sex};\n\\node[anchor = east, align = center, font = \\footnotesize] at (l2.west) {Race};\n\\node[anchor = east, align = center, font = \\footnotesize] at (l3.west) {Mom Education};\n\\node[anchor = east, align = center, font = \\footnotesize] at (l4.west) {Dad Education};\n\\node[anchor = east, align = center, font = \\footnotesize] at (l5.west) {Income};\n\\node[anchor = east, align = center, font = \\footnotesize] at (l6.west) {Wealth};\n\\node[anchor = east, align = center, font = \\footnotesize] at (l7.west) {Test Percentile};\n\\end{tikzpicture}\n\n. . .\n\n\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n\n\n\\huge\n**100%** of the sample \n\n\\normalsize\nis in a subgroup with either 0 treated or 0 untreated units\n\n\n## Learning goals for today\n\nAt the end of class, you will be able to\n\n- explain the curse of dimensionality\n- recognize the possible futility of nonparametric estimation\n\nAfter class, you should\n\n- read [Hernán \\& Robins Ch 11](https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/)\n- attend discussion: you will learn to use models!\n     ",
    "supporting": [
      "lec11_whymodel_files/figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}